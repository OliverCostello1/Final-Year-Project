<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bidder</title>
  <link rel="stylesheet" href="https://fyp-bidder.web.app/styles.css"> <!-- Link to the external CSS -->
  <script type="module" src="https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js"></script>
  <script type="module" src="https://fyp-bidder.web.app/deploy.js"></script>
</head>
<body>

<h1>Deploy Contract</h1>
<button id="deployButton">Deploy Contract</button>

<!-- Log container -->
<div id="logContainer"></div>

<!-- Contract details display -->
<div id="contractDetails"></div>

<script type="module">
  // Import the deploy.js script to access the processBids function
  import { processBids } from "https://fyp-bidder.web.app/deploy.js";

  // Initialize Firebase and Firestore
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAZx5pfgzczeuHWJSZVmes98jgOSmZCcVQ",
    authDomain: "fyp-bidder.firebaseapp.com",
    databaseURL: "https://fyp-bidder-default-rtdb.firebaseio.com",
    projectId: "fyp-bidder",
    storageBucket: "fyp-bidder.firebasestorage.app",
    messagingSenderId: "801916913350",
    appId: "1:801916913350:web:87294a67b770059efa39c7",
    measurementId: "G-BJL419PKWN"
  };

  const app = initializeApp(firebaseConfig);
  const firestore = getFirestore(app);
  console.log("Firestore initialized");

  // Display log messages in the log container
  function displayLog(message, type = 'log') {
    const logContainer = document.getElementById('logContainer');
    const logMessage = document.createElement('div');
    logMessage.textContent = message;

    if (type === 'error') {
      logMessage.classList.add('error');
    } else if (type === 'success') {
      logMessage.classList.add('success');
    }

    logContainer.appendChild(logMessage);
    logContainer.scrollTop = logContainer.scrollHeight; // Keep the log scrolled to the bottom
  }

  // Display contract details in the contract details section
  function displayContractDetails(transactionHash, contractAddress) {
    const contractDetails = document.getElementById('contractDetails');
    contractDetails.innerHTML = `
      <h3>Contract Deployed Successfully!</h3>
      <p><strong>Transaction Hash:</strong> ${transactionHash}</p>
      <p><strong>Contract Address:</strong> ${contractAddress}</p>
    `;
  }

  // Button click to deploy contract
  document.getElementById('deployButton').addEventListener('click', async () => {
    try {
      displayLog('Checking for new bids...', 'log');

      // Assuming processBids() is a function you call to start the contract deployment process
      const { transactionHash, contractAddress } = await processBids();

      // Display success message after deployment
      displayLog('Contract deployed successfully!', 'success');
      displayContractDetails(transactionHash, contractAddress);
    } catch (error) {
      displayLog(`Error: ${error.message}`, 'error');
    }
  });
</script>


</body>
</html>
